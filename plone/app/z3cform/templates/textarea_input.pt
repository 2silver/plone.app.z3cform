<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://namespaces.zope.org/i18n"
      tal:omit-tag=""
      i18n:domain="plone"
      tal:define="maxlength view/field/max_length|nothing">
    <textarea
        id="" name="" class="" cols="" rows=""
        tabindex="" disabled="" readonly="" accesskey=""
        tal:attributes="id view/id;
                        name view/name;
                        class view/klass;
                        style view/style;
                        title view/title;
                        lang view/lang;
                        onclick view/onclick;
                        ondblclick view/ondblclick;
                        onmousedown view/onmousedown;
                        onmouseup view/onmouseup;
                        onmouseover view/onmouseover;
                        onmousemove view/onmousemove;
                        onmouseout view/onmouseout;
                        onkeypress view/onkeypress;
                        onkeydown view/onkeydown;
                        onkeyup view/onkeyup;
                        disabled view/disabled;
                        tabindex view/tabindex;
                        onfocus view/onfocus;
                        onblur view/onblur;
                        onchange view/onchange;
                        cols view/cols;
                        rows view/rows;
                        readonly view/readonly;
                        accesskey view/accesskey;
                        onselect view/onselect"
        tal:content="view/value" />
    <tal:block tal:condition="maxlength">
        <div i18n:translate="label_characters_remaining">
            <input readonly="readonly"
                   type="text"
                   maxlength="4"
                   size="4"
                   value=""
                   i18n:name="count"
                   tal:attributes="id string:maxlength_${view/id};"
                   style="display: none;" />
            characters remaining
        </div>
        <script type="text/javascript">
          function textCounter(field, countfield, maxlimit) {
            var fieldval = field.attr('value');
            if (fieldval.length > maxlimit) {
                field.attr('value',  fieldval.substring(0, maxlimit));
                alert( 'This field is limited to ' + maxlimit + ' characters in length.' );
            } 
            $('input[id="' + countfield + '"]').attr('value', Math.max(maxlimit - fieldval.length, 0));
          }
        </script>
        <script type="text/javascript" tal:content="structure string:$$('#maxlength_${view/id}').show(); textCounter($$('#${view/id}'), 'maxlength_${view/id}', ${maxlength}); $$('#${view/id}').keyup(function() { textCounter($$(this), 'maxlength_${view/id}', ${maxlength}); }).keyup(function() { textCounter($$(this), 'maxlength_${view/id}', ${maxlength}); });">
        </script>
    </tal:block>
</html>
